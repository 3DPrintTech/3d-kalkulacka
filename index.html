<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Kalkulačka | 3DPrintTech</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0a0f1c url('https://raw.githubusercontent.com/3DPrintTech/3d-kalkulacka/main/laborator-bg.jpg.png') no-repeat center center fixed;
      background-size: cover;
      color: white;
      display: flex;
      justify-content: center;
      padding: 30px 0;
    }
    .kalkulacka {
      width: 810px;
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      color: white;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .top-windows {
      display: flex;
      gap: 20px;
      margin-bottom: 10px;
    }
    .viewer-container {
      width: 405px;
      height: 270px;
      background-color: #888;
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: inset 0 0 10px #555;
    }
    #result-container {
      width: 375px;
      height: 270px;
      background-color: #222;
      border-radius: 8px;
      padding: 15px;
      box-sizing: border-box;
      overflow-y: auto;
      box-shadow: inset 0 0 10px #555;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      gap: 10px;
      color: white;
      font-size: 14px;
    }
    .button-container {
      display: flex;
      gap: 20px;
      justify-content: flex-start;
    }
    .upload-label, #calculate-btn {
      display: block;
      width: 375px;
      text-align: center;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(to right, #0ff, #f0f);
      color: black;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      margin: 0;
      user-select: none;
    }
    .upload-label:hover, #calculate-btn:hover {
      transform: scale(1.03);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }
    input[type='file'] {
      display: none;
    }
    .form-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 15px;
    }
    .form-row > div {
      flex: 1;
    }
    select,
    input[type='text'],
    input[type='email'] {
      width: 100%;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(to right, #0ff, #f0f);
      color: black;
      font-weight: bold;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    select:hover,
    input[type='text']:hover,
    input[type='email']:hover {
      transform: scale(1.03);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      color: white;
    }
  </style>
</head>
<body>
  <div class="kalkulacka">
    <div class="top-windows">
      <div class="viewer-container" id="viewer"></div>
      <div id="result-container">
        <h3>Výsledek výpočtu</h3>
        <p id="vypocet-cas"></p>
        <p id="vypocet-cena"></p>
        <p id="vtipna-veta"></p>
      </div>
    </div>

    <div class="button-container">
      <label class="upload-label" for="stlInput">
        Nahraj STL model
        <input type="file" id="stlInput" accept=".stl" />
      </label>

      <button id="calculate-btn">Výpočet tisku</button>
    </div>

    <div class="bottom-section">
      <div class="form-row">
        <div>
          <label for="material">Materiál</label>
          <select id="material">
            <option>PLA</option>
            <option>PETG</option>
            <option>ABS</option>
            <option>TPU</option>
          </select>
        </div>
        <div>
          <label for="barva">Barva</label>
          <select id="barva"></select>
        </div>
      </div>
      <div class="form-row">
        <div>
          <label for="pevnost">Pevnost</label>
          <select id="pevnost">
            <option>Nízká (dekorace)</option>
            <option>Střední (držáky, vizitky atd.)</option>
            <option>Vysoká (funkční a strojní)</option>
          </select>
        </div>
        <div>
          <label for="slozitost">Složitost</label>
          <select id="slozitost">
            <option>Jednoduchý (např. vizitka, klíčenka, ozubené kolo atd.)</option>
            <option>Středně složitý (např. držáky, málo členité sochy, figurky atd.)</option>
            <option>Složitý (např. socha, figurka, dekorace s převisy a členitým povrchem)</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/loaders/STLLoader.js"></script>

  <script>
    // Barvy podle materiálu
    document.addEventListener("DOMContentLoaded", function () {
      const barvyDleMaterialu = {
        PLA: [
          "Černá",
          "Šedá",
          "Bílá",
          "Fialová",
          "Modrá",
          "Zelená",
          "Červená",
          "Růžová",
          "Oranžová",
          "Žlutá",
          "Mramor",
          "WOOD filament",
        ],
        PETG: ["Černá", "Bílá"],
        ABS: ["Černá", "Bílá"],
        TPU: ["Černá", "Bílá", "Modrá", "Zelená", "Červená", "Oranžová", "Žlutá"],
      };

      const barvaSelect = document.getElementById("barva");
      const materialSelect = document.getElementById("material");

      function updateBarvy() {
        const material = materialSelect.value;
        const barvy = barvyDleMaterialu[material] || [];
        barvaSelect.innerHTML = "";
        barvy.forEach((b) => {
          const option = document.createElement("option");
          option.textContent = b;
          barvaSelect.appendChild(option);
        });
      }

      materialSelect.addEventListener("change", updateBarvy);
      updateBarvy();
    });

    // Three.js 3D model loader
    const scene = new THREE.Scene();
    const container = document.getElementById("viewer");
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setClearColor(0x888888);
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    const camera = new THREE.PerspectiveCamera(
      45,
      container.clientWidth / container.clientHeight,
      0.1,
      1000
    );
    camera.position.set(0, 0, 150);
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const light1 = new THREE.DirectionalLight(0xffffff, 2);
    light1.position.set(50, 100, 100);
    scene.add(light1);
    scene.add(new THREE.AmbientLight(0xffffff, 0.2));

    let modelMesh;
    let currentColor = 0x111111;

    function getColorFromSelection(val) {
      const map = {
        Černá: 0x111111,
        Bílá: 0xffffff,
        Modrá: 0x0000ff,
        Červená: 0xff0000,
        Zelená: 0x00ff00,
        Žlutá: 0xffff00,
        Oranžová: 0xff6600,
        Fialová: 0x800080,
      };
      return map[val] || 0x888888;
    }

    document.addEventListener("DOMContentLoaded", function () {
      const barvaInput = document.getElementById("barva");
      if (barvaInput) {
        barvaInput.addEventListener("change", function () {
          const color = getColorFromSelection(this.value);
          currentColor = color;
          if (modelMesh) modelMesh.material.color.setHex(color);
        });
      }
    });

    document.getElementById("stlInput").addEventListener("change", function (e) {
      if (!e.target.files.length) return;
      const reader = new FileReader();
      reader.onload = function (ev) {
        const loader = new THREE.STLLoader();
        const geometry = loader.parse(ev.target.result);
        geometry.computeVertexNormals();
        geometry.computeBoundingBox();
        const size = geometry.boundingBox.getSize(new THREE.Vector3());
        const scale = 100 / size.length();
        geometry.scale(scale, scale, scale);
        geometry.center();
        if (modelMesh) scene.remove(modelMesh);
        const material = new THREE.MeshStandardMaterial({
          color: currentColor,
          metalness: 0.3,
          roughness: 0.5,
        });
        modelMesh = new THREE.Mesh(geometry, material);
        scene.add(modelMesh);
        controls.target.set(0, 0, 0);
        controls.update();
      };
      reader.readAsArrayBuffer(e.target.files[0]);
    });

    // Výpočet tisku
    document.getElementById("calculate-btn").addEventListener("click", function () {
      const hustoty = {
        PLA: 1.24,
        PETG: 1.27,
        ABS: 1.04,
        TPU: 1.21,
      };
      const pevnosti = {
        "Nízká (dekorace)": 0.1,
        "Střední (držáky, vizitky atd.)": 0.5,
        "Vysoká (funkční a strojní)": 1.0,
      };
      const vtipneVety = [
        "tisk sice trvá, ale soused ti mezitím tiskne držák na kytaru.",
        "tisk sice trvá, ale robot v kuchyni už připravuje kafe.",
        "tisk sice trvá, ale kočka už obsadila nejlepší místo na gauči.",
        "tisk sice trvá, ale tvůj model už je hvězdou na Instagramu.",
        "tisk sice trvá, ale v garáži už čeká hotové auto na dálkové ovládání.",
      ];

      const vypocetCasEl = document.getElementById("vypocet-cas");
      const vypocetCenaEl = document.getElementById("vypocet-cena");
      const vtipnaVetaEl = document.getElementById("vtipna-veta");

      const objemCm3 = 1;
      const rychlostTisku = 10;

      const material = document.getElementById("material").value;
      const pevnostVyber = document.getElementById("pevnost").value;

      const hustota = hustoty[material] || 1.2;
      const pevnost = pevnosti[pevnostVyber] || 1.0;

      const hmotnostG = objemCm3 * hustota * pevnost;
      const cena = hmotnostG * 4;

      const casTisku = hmotnostG / rychlostTisku;
      const celkovyCas = 7 + casTisku;

      const veta = vtipneVety[Math.floor(Math.random() * vtipneVety.length)];

      vypocetCasEl.textContent = `Odhadovaný čas tisku: ${celkovyCas.toFixed(
        1
      )} minut (tryska 0.4mm, výška vrstvy 0.2mm)`;
      vypocetCenaEl.textContent = `Odhadovaná cena tisku: ${cena.toFixed(2)} Kč`;
      vtipnaVetaEl.textContent = `Tisk sice trvá ${celkovyCas.toFixed(
        1
      )} minut, ale před tebou se tiskne ${veta}`;
    });
  </script>
</body>
</html>
