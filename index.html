
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>3D Kalkulačka – 3DPrintTech</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #1a1e2a;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #viewer {
      width: 540px;
      height: 640px;
      margin-top: 20px;
      position: relative;
      background-color: #1a1e2a;
    }
    #laborantka {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }
    canvas {
      position: absolute;
      top: 0; left: 0;
      z-index: 2;
    }
    #controls {
      margin-top: 20px;
    }
    input[type="file"] {
      display: none;
    }
    .custom-upload {
      padding: 10px 20px;
      background-color: #4caf50;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    .color-btn {
      margin: 5px;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .red { background-color: red; }
    .green { background-color: green; }
    .blue { background-color: blue; }
  </style>
</head>
<body>
  <h1>3D Kalkulačka</h1>
  <div id="viewer">
    <img id="laborantka" src="https://3dprinttech.github.io/3d-kalkulacka/V%C4%9Bdkyn%C4%9B%20a%20holografick%C3%A1%20technologie.png" alt="Laborantka" />
  </div>

  <div id="controls">
    <label class="custom-upload">
      Nahraj model
      <input type="file" id="stlInput" accept=".stl">
    </label>
    <div>
      <button class="color-btn red" onclick="changeColor(0xff0000)"></button>
      <button class="color-btn green" onclick="changeColor(0x00ff00)"></button>
      <button class="color-btn blue" onclick="changeColor(0x0000ff)"></button>
    </div>
  </div>

  <!-- Verze Three.js kompatibilní se starším způsobem importu -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/loaders/STLLoader.js"></script>

  <script>
    let scene = new THREE.Scene();
    scene.background = new THREE.Color(0x1a1e2a);

    const container = document.getElementById('viewer');
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(540, 640);
    container.appendChild(renderer.domElement);

    const camera = new THREE.PerspectiveCamera(45, 540 / 640, 0.1, 1000);
    camera.position.set(0, 0, 150);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    const light1 = new THREE.DirectionalLight(0xffffff, 2);
    light1.position.set(50, 100, 100);
    scene.add(light1);

    const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
    scene.add(ambientLight);

    let modelMesh;
    let currentColor = 0xff0000;

    function changeColor(color) {
      currentColor = color;
      if (modelMesh) {
        modelMesh.material.color.setHex(color);
      }
    }

    function loadSTL(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const loader = new THREE.STLLoader();
        const geometry = loader.parse(e.target.result);

        geometry.computeVertexNormals();
        geometry.computeBoundingBox();

        const size = geometry.boundingBox.getSize(new THREE.Vector3());
        const scaleFactor = 100 / size.length();
        geometry.scale(scaleFactor, scaleFactor, scaleFactor);
        geometry.center();

        if (modelMesh) scene.remove(modelMesh);

        const material = new THREE.MeshStandardMaterial({
          color: currentColor,
          metalness: 0.3,
          roughness: 0.5
        });

        modelMesh = new THREE.Mesh(geometry, material);
        scene.add(modelMesh);

        // Skryj laborantku až po úspěšném načtení
        const laborantka = document.getElementById('laborantka');
        if (laborantka) laborantka.remove();

        controls.target.set(0, 0, 0);
        controls.update();
      };
      reader.readAsArrayBuffer(file);
    }

    document.getElementById('stlInput').addEventListener('change', function(event) {
      if (event.target.files.length > 0) {
        loadSTL(event.target.files[0]);
      }
    });

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    animate();
  </script>
</body>
</html>
