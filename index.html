<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D Kalkulačka | 3DPrintTech</title>
  <style>
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #0a0f1c url('https://raw.githubusercontent.com/3DPrintTech/3d-kalkulacka/main/laborator-bg.jpg.png') no-repeat center center fixed; background-size: cover; color: white; display: flex; justify-content: center; padding: 30px 0; }
    .kalkulacka { width: 850px; background: rgba(0, 0, 0, 0.6); padding: 20px; border-radius: 12px; box-shadow: 0 0 20px rgba(255,255,255,0.1); display: flex; flex-direction: column; gap: 20px; }
    .top-windows { display: flex; gap: 20px; margin-bottom: 10px; }
    .viewer-container { width: 480px; height: 300px; background-color: #888; position: relative; border-radius: 8px; overflow: hidden; box-shadow: inset 0 0 10px #555; }
    #result-container { width: 350px; height: 300px; background-color: #222; border-radius: 8px; padding: 15px; box-sizing: border-box; overflow-y: auto; box-shadow: inset 0 0 10px #555; display: flex; flex-direction: column; justify-content: flex-start; gap: 10px; font-size: 14px; }
    .button-container { display: flex; gap: 20px; justify-content: flex-start; }
    .upload-label, #calculate-btn { display: block; width: 415px; text-align: center; padding: 10px 20px; border: none; border-radius: 6px; background: linear-gradient(to right, #0ff, #f0f); color: black; font-weight: bold; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .upload-label:hover, #calculate-btn:hover { transform: scale(1.03); box-shadow: 0 0 10px rgba(255,255,255,0.3); }
    input[type='file'] { display: none; }
    .form-row { display: flex; justify-content: space-between; gap: 10px; margin-bottom: 15px; }
    select, input[type='text'], input[type='email'] { width: 100%; padding: 10px 20px; border: none; border-radius: 6px; background: linear-gradient(to right, #0ff, #f0f); color: black; font-weight: bold; cursor: pointer; appearance: none; transition: transform 0.2s ease, box-shadow 0.2s ease; }
    select:hover, input[type='text']:hover, input[type='email']:hover { transform: scale(1.03); box-shadow: 0 0 10px rgba(255,255,255,0.3); }
    label { display: block; margin-bottom: 5px; font-weight: bold; color: white; }
  </style>
</head>
<body>
  <div class="kalkulacka">
    <div class="top-windows">
      <div class="viewer-container" id="viewer"></div>
      <div id="result-container">
        <h3>Výsledek výpočtu</h3>
        <p id="vypocet-cas"></p>
        <p id="vypocet-cena"></p>
        <p id="vtipna-veta"></p>
      </div>
    </div>

    <div class="button-container">
      <label class="upload-label" for="stlInput">Nahraj STL model<input type="file" id="stlInput" accept=".stl"/></label>
      <button id="calculate-btn">Výpočet tisku</button>
    </div>

    <div class="bottom-section">
      <div class="form-row">
        <div><label for="material">Materiál</label><select id="material"><option>PLA</option><option>PETG</option><option>ABS</option><option>TPU</option></select></div>
        <div><label for="barva">Barva</label><select id="barva"></select></div>
      </div>
      <div class="form-row">
        <div><label for="pevnost">Pevnost</label><select id="pevnost"><option>Nízká (dekorace)</option><option>Střední (držáky, vizitky atd.)</option><option>Vysoká (funkční a strojní)</option></select></div>
        <div><label for="slozitost">Složitost</label><select id="slozitost"><option>Jednoduchý (např. vizitka, klíčenka, ozubené kolo atd.)</option><option>Středně složitý (např. držáky, málo členité sochy, figurky atd.)</option><option>Složitý (např. socha, figurka, dekorace s převisy a členitým povrchem)</option></select></div>
      </div>
    </div>
  </div>

  <!-- Three.js knihovny -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/loaders/STLLoader.js"></script>

  <script>
    // Barevné předvolby dle materiálu
    const barvyDleMaterialu = { PLA:["Černá","Šedá","Bílá","Fialová","Modrá","Zelená","Červená","Růžová","Oranžová","Žlutá","Mramor","WOOD filament"], PETG:["Černá","Bílá"], ABS:["Černá","Bílá"], TPU:["Černá","Bílá","Modrá","Zelená","Červená","Oranžová","Žlutá"] };
    const materialSelect = document.getElementById('material'); const barvaSelect = document.getElementById('barva');
    function updateBarvy(){ barvaSelect.innerHTML=''; (barvyDleMaterialu[materialSelect.value]||[]).forEach(c=>{let o=document.createElement('option');o.textContent=c;barvaSelect.appendChild(o);}); }
    materialSelect.addEventListener('change',updateBarvy); updateBarvy();

    // Three.js scéna
    const scene=new THREE.Scene();
    const viewer=document.getElementById('viewer');
    const renderer=new THREE.WebGLRenderer({antialias:true});
    renderer.setClearColor(0x888888); // pozadí renderu na šedou
    renderer.setSize(viewer.clientWidth,viewer.clientHeight);
    viewer.appendChild(renderer.domElement);
    const camera=new THREE.PerspectiveCamera(45,viewer.clientWidth/viewer.clientHeight,0.1,1000);
    camera.position.set(0,0,150);
    const controls=new THREE.OrbitControls(camera,renderer.domElement);
    controls.enableDamping=true;

    // Směrové světlo umístěné vždy v pozici kamery
    const dirLight=new THREE.DirectionalLight(0xffffff,2);
    scene.add(dirLight);
    scene.add(new THREE.AmbientLight(0xffffff,0.2));

    let modelMesh,currentColor=0x111111;
    function getColor(v){return{Černá:0x111111,Bílá:0xffffff,Modrá:0x0000ff,Červená:0xff0000,Zelená:0x00ff00,Žlutá:0xffff00,Oranžová:0xff6600,Fialová:0x800080}[v]||0x888888;}
    barvaSelect.addEventListener('change',()=>{currentColor=getColor(barvaSelect.value);if(modelMesh)modelMesh.material.color.setHex(currentColor);});

    document.getElementById('stlInput').addEventListener('change',e=>{if(!e.target.files.length)return;const r=new FileReader();r.onload=ev=>{const l=new THREE.STLLoader();const g=l.parse(ev.target.result);g.computeVertexNormals();g.computeBoundingBox();const s=g.boundingBox.getSize(new THREE.Vector3()),sc=100/s.length();g.scale(sc,sc,sc);g.center();if(modelMesh)scene.remove(modelMesh);const m=new THREE.MeshStandardMaterial({color:currentColor,metalness:0.3,roughness:0.5});modelMesh=new THREE.Mesh(g,m);scene.add(modelMesh);controls.target.set(0,0,0);controls.update();};r.readAsArrayBuffer(e.target.files[0]);});

    // Výpočet tisku
    document.getElementById('calculate-btn').addEventListener('click',()=>{const hustoty={PLA:1.24,PETG:1.27,ABS:1.04,TPU:1.21};const pevnosti={"Nízká (dekorace)":0.1,"Střední (držáky, vizitky atd.)":0.5,"Vysoká (funkční a strojní)":1.0};const vtipne=["ale tiskne se sousedovi držák na kytaru.","ale robot v kuchyni už připravuje kafe.","ale zrovna nejsem doma.","ale před tebou je fronta jako na poště.","ale dnes je moc teplo."];const casEl=document.getElementById('vypocet-cas'),cenEl=document.getElementById('vypocet-cena'),vetEl=document.getElementById('vtipna-veta');const objemCm3=1,rychlost=10;const mat=materialSelect.value,pev=document.getElementById('pevnost').value;const hmot=objemCm3*hustoty[mat]*pevnosti[pev];const cena=hmot*4,cas=hmot/rychlost,celk=7+cas;casEl.textContent=`Odhadovaný čas tisku: ${celk.toFixed(1)} minut`;cenEl.textContent=`Odhadovaná cena tisku: ${cena.toFixed(2)} Kč`;vetEl.textContent=`Tisk sice trvá ${celk.toFixed(1)} minut ${vtipne[Math.floor(Math.random()*vtipne.length)]}`;});

    // Animace a synchronizace světla s kamerou
    function animate(){requestAnimationFrame(animate);controls.update();dirLight.position.copy(camera.position);renderer.render(scene,camera);}animate();
  </script>
</body>
</html>
